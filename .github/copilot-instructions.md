# Forged Hand Studios - AI Coding Agent Instructions

## Architecture Overview

This is a **React Router v7** application with **server-side rendering (SSR)** deployed to **Netlify Functions**. Key architectural decisions:

- Uses React Router v7's new file-based routing with explicit route definitions in `app/routes.ts`
- SSR is enabled via `react-router.config.ts` (set `ssr: false` to switch to SPA mode)
- Netlify Functions handle server-side rendering through `server/app.ts`
- Custom development server (`dev-server.js`) uses Express + Vite middleware for HMR

## Development Workflow

### Essential Commands

- `npm run dev` - Start development server with HMR (uses custom Express server, not standard Vite)
- `npm run build` - Production build + Netlify preparation (runs `netlify/prepare.js`)
- `npm run typecheck` - Generate types + TypeScript check
- `npm start` - Serve production build via Netlify CLI

### Build Process

1. `react-router build` creates `build/client` and `build/server`
2. `netlify/prepare.js` copies server build to `.netlify/functions-internal/handler`
3. Netlify serves client from `build/client`, functions from `.netlify/functions-internal`

## Project-Specific Patterns

### Route Definition

Routes are explicitly defined in `app/routes.ts`, not auto-discovered:

```typescript
export default [index("routes/home.tsx")] satisfies RouteConfig;
```

### Route Module Pattern

Each route exports typed functions using generated types:

```typescript
// app/routes/home.tsx
import type { Route } from "./+types/home"; // Auto-generated types

export function meta({}: Route.MetaArgs) {
  /* ... */
}
export function loader({ context }: Route.LoaderArgs) {
  /* ... */
}
export default function Home({ loaderData }: Route.ComponentProps) {
  /* ... */
}
```

### SSR Context Integration

`server/app.ts` defines the Netlify Functions handler and extends `AppLoadContext`:

```typescript
declare module "react-router" {
  interface AppLoadContext {
    VALUE_FROM_NETLIFY: string; // Add custom context properties here
  }
}
```

### Component Organization

- Components live in feature directories (e.g., `app/welcome/welcome.tsx`)
- Import components relatively from route files
- Static assets (SVGs, images) co-located with components

## Development Environment

### TypeScript Configuration

- Uses `vite-tsconfig-paths` for path resolution
- Route types auto-generated by React Router CLI
- Run `npm run typecheck` after route changes

### Styling

- **Tailwind CSS v4** configured via `@tailwindcss/vite` plugin
- Global styles in `app/app.css`
- Dark mode classes available (`dark:` prefix)

### Deployment Context

- Configured for **Netlify** with immutable asset caching
- Development uses custom Express server, production uses Netlify Functions
- `netlify.toml` defines build and caching rules

## Key Files to Understand

- `app/routes.ts` - Route definitions (modify when adding routes)
- `react-router.config.ts` - SSR and build configuration
- `server/app.ts` - Netlify Functions handler and context setup
- `dev-server.js` - Custom development server setup
- `vite.config.ts` - Build configuration with conditional SSR input
